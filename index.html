<!DOCTYPE html>
<html>
<head>
    <title>Trust Bazaar Market</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        body { background: #f4f7f6; font-family: sans-serif; margin: 0; padding-bottom: 60px; }
        
        /* Header & Nav */
        header { background: #673ab7; color: white; padding: 15px; text-align: center; position: sticky; top:0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .nav-bar { display: flex; justify-content: space-around; background: white; padding: 10px; position: fixed; bottom: 0; width: 100%; border-top: 1px solid #ddd; }
        .nav-btn { background: none; border: none; font-size: 24px; color: #999; cursor: pointer; }
        .nav-btn.active { color: #673ab7; }

        /* Views */
        .view { display: none; padding: 20px; animation: fade 0.3s; }
        .view.active { display: block; }

        /* Cards */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .job-card { border-left: 5px solid #673ab7; }
        
        /* Buttons */
        .btn-main { background: #673ab7; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-action { background: #e1bee7; color: #4a148c; border: none; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; float: right; }

        /* Input Form */
        input, textarea { width: 90%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; display: block; }
        
        @keyframes fade { from { opacity:0; } to { opacity:1; } }
    </style>
</head>
<body>

    <header>
        <h2 style="margin:0;">Trust Bazaar</h2>
        <small id="username">Connecting...</small>
    </header>

    <div id="view-market" class="view active">
        <h3>üî• Hot Jobs</h3>
        <div id="job-feed">
            </div>
    </div>

    <div id="view-post" class="view">
        <h3>üìù Create New Job</h3>
        <div class="card">
            <label>Job Title</label>
            <input type="text" id="job-title" placeholder="e.g. Logo Design">
            
            <label>Price (Pi)</label>
            <input type="number" id="job-price" placeholder="50">
            
            <label>Description</label>
            <textarea id="job-desc" rows="3" placeholder="Describe the task..."></textarea>
            
            <button class="btn-main" onclick="postNewJob()">Publish Job</button>
        </div>
    </div>

    <div id="view-profile" class="view">
        <div class="card" style="text-align: center;">
            <div style="font-size: 50px;">üõ°Ô∏è</div>
            <h1>88%</h1>
            <p>Trust Score Verified</p>
            <hr>
            <p>Total Spent: <b id="spent">0 Pi</b></p>
            <button class="btn-main" onclick="alert('Audit is up to date!')">Refresh Score</button>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchView('market')">üè†</button>
        <button class="nav-btn" onclick="switchView('post')">‚ûï</button>
        <button class="nav-btn" onclick="switchView('profile')">üë§</button>
    </div>

    <script>
        // --- 1. SETUP & DATA ---
        let myJobs = JSON.parse(localStorage.getItem('trustJobs')) || [
            { title: "Website Audit", price: 100, user: "PiCoreTeam" },
            { title: "Translate App", price: 25, user: "GlobalMod" }
        ];

        // --- 2. SWITCH TABS ---
        function switchView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            // Show selected
            document.getElementById('view-' + viewName).classList.add('active');
            
            // Update icons (Visual only logic)
            if(viewName === 'market') renderFeed();
        }

        // --- 3. RENDER FEED ---
        function renderFeed() {
            const feed = document.getElementById('job-feed');
            feed.innerHTML = ""; // Clear list
            
            myJobs.forEach(job => {
                const html = `
                    <div class="card job-card">
                        <button class="btn-action" onclick="apply('${job.title}')">APPLY</button>
                        <h4 style="margin:0 0 5px 0;">${job.title}</h4>
                        <div style="color:#673ab7; font-weight:bold;">${job.price} œÄ</div>
                        <small style="color:#888;">Posted by: ${job.user || 'Pinoy'}</small>
                    </div>
                `;
                feed.innerHTML += html;
            });
        }

        // --- 4. POST NEW JOB ---
        function postNewJob() {
            const title = document.getElementById('job-title').value;
            const price = document.getElementById('job-price').value;
            const user = document.getElementById('username').innerText;

            if(!title || !price) return alert("Please fill all fields");

            // Add to list
            myJobs.unshift({ title: title, price: price, user: user });
            
            // Save to phone memory (Simulated Database)
            localStorage.setItem('trustJobs', JSON.stringify(myJobs));
            
            // Clear inputs and go home
            document.getElementById('job-title').value = "";
            document.getElementById('job-price').value = "";
            alert("‚úÖ Job Posted Successfully!");
            switchView('market');
        }

        // --- 5. APPLY ACTION ---
        function apply(jobTitle) {
            // Here you would normally trigger the 1 Pi payment flow!
            if(confirm("Pay 1 Pi deposit to apply for: " + jobTitle + "?")) {
                alert("üíé Deposit Paid! Employer notified.");
            }
        }

        // --- 6. PI SDK INIT ---
        window.onload = function() {
            renderFeed(); // Load initial jobs
            try {
                Pi.init({ version: "2.0" });
                Pi.authenticate(['username', 'payments'], (p) => { Pi.payment.complete(p.identifier); })
                    .then(auth => { 
                        document.getElementById('username').innerText = auth.user.username; 
                    });
            } catch(e) {}
        };
    </script>
</body>
</html>